trigger:
- master
- azure-pipelines

stages:
  - stage:
    jobs:
      - job: 'Build_PyInstaller_Windows'
        pool: 
          vmImage: 'windows-latest'
        steps:
        - task: UsePythonVersion@0
          inputs:
            versionSpec: '3.7'
        - script: python -m pip install --upgrade pip
          displayName: 'update pip'
        - script: python -m pip install wheel
          displayName: 'install wheel'
        - script: python -m pip install pyinstaller
          displayName: 'install pyinstaller'
        - script: python -m pip install -r ./requirements.txt
          displayName: 'install HerbASAP requirements'
        - script: copy .\docs\build_docs\win-build.spec .\win-build.spec
          displayName: 'copy spec file to dir root'
        - script: pyinstaller ./win-build.spec
          displayName: 'build HerbASAP pyinstaller'
        - script: echo $(System.DefaultWorkingDirectory)
          displayName: 'echo default working directory'
        - script: dir $(System.DefaultWorkingDirectory)\dist
          displayName: 'list default working directory contents'
        # - task: PublishPipelineArtifact@1
        #   displayName: 'publish windows build output'
        #   inputs:
        #     path: $(System.DefaultWorkingDirectory)/dist/*.exe
        #     artifact: win-build

      - job: 'Build_PyInstaller_MacOS'
        pool: 
          vmImage: 'macOS-latest'
        steps:
        - task: UsePythonVersion@0
          inputs:
            versionSpec: '3.7'
        - script: python -m pip install --upgrade pip
          displayName: 'update pip'
        - script: python -m pip install wheel
          displayName: 'update wheel'
        - script: python -m pip install pyinstaller
          displayName: 'install pyinstaller'
        - script: python -m pip install -r ./requirements.txt
          displayName: 'install HerbASAP requirements'
        - script: cp ./docs/build_docs/macos-build.spec ./macos-build.spec
          displayName: 'copy spec file to dir root'
        - script: pyinstaller ./macos-build.spec
          displayName: 'build HerbASAP pyinstaller'
        - script: echo $(System.DefaultWorkingDirectory)
          displayName: 'echo default working directory'
        - script: ls $(System.DefaultWorkingDirectory)/dist
          displayName: 'list default working directory contents'
        # - task: PublishPipelineArtifact@1
        #   displayName: 'publish macos build output'
        #   inputs:
        #     path: $(System.DefaultWorkingDirectory)/dist/*.app
        #     artifact: macos-build
